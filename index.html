<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <title>Aim Pro</title>
    <style>
        :root { --n: #0fcc; --h: #f36; }
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; touch-action: none; color: #fff; }
        .screen { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; background: rgba(0,0,0,.8); z-index: 20; backdrop-filter: blur(5px); }
        .hidden { display: none !important; }
        #hud { position: absolute; top: 20px; left: 20px; z-index: 10; pointer-events: none; }
        .stat { background: rgba(0,204,204,.1); border-left: 4px solid var(--n); padding: 8px; margin-bottom: 5px; font-weight: bold; }
        #cross-cont { position: absolute; inset: 50%; width: 40px; height: 40px; transform: translate(-50%,-50%); pointer-events: none; z-index: 5; }
        #cross { width: 100%; height: 100%; border: 2px solid var(--n); border-radius: 50%; opacity: .5; transition: .1s; }
        #hit-m { position: absolute; inset: 0; display: flex; justify-content: center; align-items: center; color: var(--h); font-weight: bold; opacity: 0; }
        .hit #cross { border-color: var(--h); transform: scale(1.2); opacity: 1; }
        .hit #hit-m { opacity: 1; }
        #shoot { position: absolute; bottom: 40px; right: 40px; width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--n); background: rgba(0,204,204,.1); color: var(--n); font-weight: bold; z-index: 30; display: flex; justify-content: center; align-items: center; }
        button { padding: 15px 50px; background: var(--n); border: none; border-radius: 30px; font-weight: bold; font-size: 1.2rem; cursor: pointer; }
    </style>
</head>
<body>

<div id="hud" class="hidden"><div class="stat">SCORE: <span id="s-val">0</span></div><div class="stat">TIME: <span id="t-val">60</span></div></div>
<div id="combo" style="position:absolute; top:20px; right:20px; color:var(--h); font-size:2rem; font-weight:900;"></div>
<div id="cross-cont" class="hidden"><div id="cross"></div><div id="hit-m">Ã—</div></div>
<div id="shoot" class="hidden">FIRE</div>

<div id="menu" class="screen">
    <h1 id="title" style="color:var(--n); text-shadow:0 0 10px var(--n)">AIM PRO</h1>
    <p>BEST: <span id="b-val">0</span></p>
    <div style="width:250px; text-align:center; margin:20px;">
        Sens: <span id="sens-l">0.15</span><br>
        <input id="sens-s" type="range" min="0.05" max="0.5" value="0.15" step="0.01" style="width:100%">
    </div>
    <button id="play">START</button>
</div>

<div id="count" class="screen hidden"><h1 id="cd-t" style="font-size:8rem; color:var(--n)">3</h1></div>

<script type="module">
import * as THREE from "https://cdn.skypack.dev/three@0.136.0";

const $ = id => document.getElementById(id);
let sens=0.15, score=0, time=60, combo=0, lastH=0, run=false, pool=[], tInt, sInt;

const ctx = new (window.AudioContext||window.webkitAudioContext)();
const tone = (f, t="sine", v=0.1, d=0.1) => {
    const o=ctx.createOscillator(), g=ctx.createGain();
    o.type=t; o.frequency.value=f; g.gain.value=v;
    g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+d);
    o.connect(g); g.connect(ctx.destination); o.start(); o.stop(ctx.currentTime+d);
};

const scene = new THREE.Scene();
const cam = new THREE.PerspectiveCamera(75, innerWidth/innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(innerWidth, innerHeight);
renderer.setPixelRatio(devicePixelRatio);
document.body.appendChild(renderer.domElement);

scene.add(new THREE.AmbientLight(0xffffff, 0.4));
const pL = new THREE.PointLight(0x00ffcc, 1); cam.add(pL); scene.add(cam);

// Starfield
const sGeo = new THREE.BufferGeometry(), sPos = [];
for(let i=0; i<3000; i++) sPos.push((Math.random()-0.5)*400, (Math.random()-0.5)*400, (Math.random()-0.5)*400);
sGeo.setAttribute("position", new THREE.Float32BufferAttribute(sPos, 3));
scene.add(new THREE.Points(sGeo, new THREE.PointsMaterial({color:0x888888, size:0.6})));

// Targets
for(let i=0; i<10; i++) {
    const t = new THREE.Mesh(new THREE.IcosahedronGeometry(0.7,0), new THREE.MeshPhongMaterial({color:0x00ffcc, emissive:0x002211, flatShading:true}));
    t.visible = false; t.userData = { active: false };
    scene.add(t); pool.push(t);
}

const spawn = () => {
    if(!run) return;
    const t = pool.find(x => !x.userData.active);
    if(!t) return;
    const a = (Math.random()-0.5)*Math.PI*1.5, d = 12 + Math.random()*8;
    t.position.set(Math.sin(a)*d, (Math.random()-0.5)*8, -Math.cos(a)*d);
    t.scale.set(0.01, 0.01, 0.01); t.visible = true; t.userData.active = true; t.userData.age = performance.now();
};

let lon=0, lat=0, sx, sy, slon, slat;
addEventListener("touchstart", e => { sx=e.touches[0].clientX; sy=e.touches[0].clientY; slon=lon; slat=lat; });
addEventListener("touchmove", e => {
    if(!run) return;
    lon = slon - (e.touches[0].clientX - sx)*sens;
    lat = Math.max(-85, Math.min(85, slat + (sy - e.touches[0].clientY)*sens));
});

const ray = new THREE.Raycaster();
$("shoot").ontouchstart = e => {
    e.preventDefault(); if(!run) return;
    tone(140, "sawtooth", 0.05, 0.1);
    ray.setFromCamera({x:0, y:0}, cam);
    const hit = ray.intersectObjects(pool.filter(o => o.userData.active))[0];
    if(hit) {
        hit.object.userData.active = false;
        let n = performance.now();
        combo = (n-lastH < 1000 ? combo+1 : 1); lastH = n;
        score += combo; $("s-val").textContent = score;
        $("combo").textContent = combo > 1 ? combo+"x" : "";
        $("cross-cont").classList.add("hit"); setTimeout(() => $("cross-cont").classList.remove("hit"), 150);
        tone(600+combo*80, "sine", 0.15, 0.1);
    }
};

const begin = () => {
    run = true; score = 0; time = 60; combo = 0;
    $("s-val").textContent = 0; $("b-val").textContent = localStorage.getItem("aimProBest") || 0;
    $("menu").classList.add("hidden"); $("hud").classList.remove("hidden"); $("shoot").classList.remove("hidden"); $("cross-cont").classList.remove("hidden");
    pool.forEach(o => o.userData.active = false); // Clean reset
    tInt = setInterval(() => { time--; $("t-val").textContent = time; if(time <= 0) stop(); }, 1000);
    sInt = setInterval(spawn, 550);
};

const stop = () => {
    run = false; clearInterval(tInt); clearInterval(sInt);
    if(score > (localStorage.getItem("aimProBest")||0)) localStorage.setItem("aimProBest", score);
    ["hud", "shoot", "cross-cont"].forEach(id => $(id).classList.add("hidden"));
    $("menu").classList.remove("hidden"); $("title").textContent = "PLAY AGAIN";
};

$("play").onclick = () => {
    ctx.resume(); $("menu").classList.add("hidden"); $("count").classList.remove("hidden");
    let c = 3; $("cd-t").textContent = c;
    let i = setInterval(() => { c--; tone(300); $("cd-t").textContent = c; if(c <= 0) { clearInterval(i); $("count").classList.add("hidden"); begin(); } }, 1000);
};

$("sens-s").oninput = e => { sens = parseFloat(e.target.value); $("sens-l").textContent = sens.toFixed(2); };

(function loop(){
    requestAnimationFrame(loop);
    cam.lookAt(new THREE.Vector3().setFromSphericalCoords(100, THREE.MathUtils.degToRad(90-lat), THREE.MathUtils.degToRad(lon)));
    pool.forEach(o => {
        if(o.userData.active) { o.scale.lerp(new THREE.Vector3(1,1,1), 0.1); o.rotation.y += 0.03; if(performance.now()-o.userData.age > 2600) o.userData.active = false; }
        else { o.scale.lerp(new THREE.Vector3(0.01,0.01,0.01), 0.2); if(o.scale.x < 0.05) o.visible = false; }
    });
    renderer.render(scene, cam);
})();

addEventListener("resize", () => { cam.aspect = innerWidth/innerHeight; cam.updateProjectionMatrix(); renderer.setSize(innerWidth, innerHeight); });
</script>
</body>
</html>
